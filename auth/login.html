<!DOCTYPE html>
<html>
<head>
  <title>Login</title>
</head>
<body>

<h2>Login</h2>

<input type="email" id="email" placeholder="Email"><br><br>
<input type="password" id="password" placeholder="Password"><br><br>

<select id="loginRole">
  <option value="admin">Admin</option>
  <option value="vendor">Vendor</option>
  <option value="customer">Customer</option>
</select><br><br>

<button id="loginBtn">Login</button>
<p id="msg"></p>

<script type="module">
import { auth, db } from "../firebase.js";
import { signInWithEmailAndPassword }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { doc, getDoc }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

loginBtn.onclick = async () => {
  try {
    const cred = await signInWithEmailAndPassword(auth, email.value, password.value);
    const snap = await getDoc(doc(db, "users", cred.user.uid));

    if (!snap.exists()) throw "No role found";

    const role = snap.data().role;
    if (role !== loginRole.value) throw "Unauthorized role";

    if (role === "admin") location.href = "/admin/dashboard.html";
    if (role === "vendor") location.href = "/vendor/dashboard.html";
    if (role === "customer") location.href = "/customer/dashboard.html";

  } catch (e) {
    msg.innerText = e;
  }
};
</script>

</body>
</html>
